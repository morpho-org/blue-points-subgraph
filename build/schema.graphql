enum PositionType {
  SUPPLY
  BORROW
  COLLATERAL
}

type MorphoTx @entity {
  id: Bytes!

  type: PositionType!

  user: User!

  market: Market!

  shares: BigInt!

  timestamp: BigInt!

  # Additionals informations
  txHash: Bytes!
  txIndex: BigInt!
  logIndex: BigInt!
  blockNumber: BigInt!
}

type User @entity {
  id: Bytes!

  morphoTx: [MorphoTx!]! @derivedFrom(field: "user")
  positions: [Position!]! @derivedFrom(field: "user")
}

type Market @entity {
  id: Bytes!

  totalSupplyShares: BigInt!
  totalBorrowShares: BigInt!
  totalCollateral: BigInt!

  morphoTx: [MorphoTx!]! @derivedFrom(field: "market")
  rewardsRates: [RewardsRate!]! @derivedFrom(field: "market")
  positions: [Position!]! @derivedFrom(field: "market")
}

type URD @entity {
  id: Bytes!

  rewardsRates: [RewardsRate!]! @derivedFrom(field: "urd")
}

type Position @entity {
  "concat of the user address and the market id"
  id: Bytes!

  user: User!
  market: Market!
  supplyShares: BigInt!
  borrowShares: BigInt!
  collateral: BigInt!

  rewards: [PositionRewards!]! @derivedFrom(field: "position")
}

type PositionRewards @entity {
  "concat of the position id and the rewards rate id"
  id: Bytes!

  rewardsRate: RewardsRate!
  position: Position!

  positionSupplyIndex: BigInt!
  positionBorrowIndex: BigInt!
  positionCollateralIndex: BigInt!

  positionSupplyAccrued: BigInt!
  positionBorrowAccrued: BigInt!
  positionCollateralAccrued: BigInt!
}

type RewardsRate @entity {
  "concat of the sender, market id, urd and the rewards token address"
  id: Bytes!
  sender: Bytes!

  urd: URD!

  rewardToken: Bytes!

  market: Market!

  supplyRatePerYear: BigInt!
  borrowRatePerYear: BigInt!
  collateralRatePerYear: BigInt!

  availableAt: BigInt!

  supplyIndex: BigInt!
  borrowIndex: BigInt!
  collateralIndex: BigInt!

  lastUpdateTimestamp: BigInt!

  rateUpdates: [RateUpdateTx!]! @derivedFrom(field: "rewardsRate")
}

type RateUpdateTx @entity {
  id: Bytes!

  sender: Bytes!

  urd: URD!

  rewardToken: Bytes!

  market: Market!

  supplyRatePerYear: BigInt!
  borrowRatePerYear: BigInt!
  collateralRatePerYear: BigInt!

  rewardsRate: RewardsRate!

  timestamp: BigInt!

  # Additionals informations
  txHash: Bytes!
  txIndex: BigInt!
  logIndex: BigInt!
  blockNumber: BigInt!
}
